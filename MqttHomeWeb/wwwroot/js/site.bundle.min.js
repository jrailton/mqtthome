function SubscribeToPush(){navigator.serviceWorker&&navigator.serviceWorker.ready.then(function(n){RegisterPushSubscription(n)})}function RegisterPushSubscription(n){return new Promise(function(t,i){n.pushManager.getSubscription().then(function(r){r?(debug&&console.log("Already subscribed to push notifications"),window.subscription=MESSAGING.subscription=r,t(r)):n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:MESSAGING.urlB64ToUint8Array(publicKey)}).then(function(n){n&&(MESSAGING.subscribed=!0,debug&&console.log("Newly subscribed to push notifications"),window.subscription=MESSAGING.subscription=n,DATA.GetSetting("push-notified",!1).then(function(){MESSAGING.PushNotify(n)}),t(n));i()}).catch(function(){MESSAGING.get("/userapi/pushdenied")})})})}function SwitchOff(n){confirm("Are you sure you want to turn "+n+" off?")&&$("#message-content").load("/switch/off/"+n)}function SwitchOn(n){confirm("Are you sure you want to turn "+n+" on?")&&$("#message-content").load("/switch/on/"+n)}